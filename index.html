<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>When You Breathe — Mandala</title>
<style>
  :root{
    --inhale: 4.5s;   /* in-breath */
    --hold:   1.0s;   /* top hold  */
    --exhale: 5.5s;   /* out-breath */
    --diam:   min(86vmin, 560px);
    --bg:#0b0f1a; --ink:#e6e9f6;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
    font-family:ui-sans-serif,system-ui,Segoe UI,Arial}
  .wrap{min-height:100%;display:grid;place-items:center;padding:14px;gap:12px}
  .mandala{width:var(--diam);height:var(--diam);border-radius:50%;
    position:relative;overflow:hidden;cursor:pointer;touch-action:manipulation;
    box-shadow:0 0 40px #000 inset,0 0 50px #000}
  /* embed your mandala image directly */
  #art{position:absolute;inset:0;
    background:url("mandala.jpg") center/cover no-repeat;
    filter:contrast(1.06) saturate(/* put this where #glow and @keyframes live */
#glow{
  position:absolute;inset:0;border-radius:50%;
  /* brighter center + wide halo */
  background:
    radial-gradient(32% 32% at 50% 50%, rgba(255,230,140,.55), transparent 72%),
    radial-gradient(80% 80% at 50% 50%, rgba(140,220,255,.20), transparent 78%);
  mix-blend-mode:screen;
  opacity:1;                 /* <- was .75 */
  transform:scale(1);
  filter:blur(0.6px);
}

/* stronger breathing motion */
.pulse #glow{
  animation:breath calc(var(--inhale) + var(--hold) + var(--exhale))
           cubic-bezier(.45,.05,.25,1) infinite;
}

@keyframes breath{
  0%   { transform:scale(0.97); filter:blur(0.4px); box-shadow:0 0 20px 6px rgba(255,230,140,.25); }
  45%  { transform:scale(1.10); filter:blur(1.6px); box-shadow:0 0 90px 28px rgba(255,230,140,.40); } /* inhale */
  60%  { transform:scale(1.10); filter:blur(1.6px); box-shadow:0 0 90px 28px rgba(255,230,140,.40); } /* hold   */
  100% { transform:scale(0.97); filter:blur(0.4px); box-shadow:0 0 24px 8px rgba(255,230,140,.28); } /* exhale */
}
  .bar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  button,input[type="range"]{
    background:#141b2d;color:#e6ecff;border:1px solid #2a3556;border-radius:8px;
    padding:.55em .9em
  }
  input[type="range"]{padding:.4em 0;width:140px}
  .hint{font-size:14px;opacity:.9;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <div id="mandala" class="mandala pulse">
    <div id="art" role="img" aria-label="Breath mandala"></div>
    <div id="glow" aria-hidden="true"></div>
    <div class="rim" aria-hidden="true"></div>
  </div>

  <div class="bar">
    <button id="toggle">pause</button>
    <button id="pace">pace: 4.5 · 1 · 5.5</button>
    <button id="sound">sound: on</button>
    <label style="display:flex;align-items:center;gap:6px">
      vol <input id="vol" type="range" min="0" max="100" value="20" />
    </label>
  </div>

  <div id="hint" class="hint">
    tap the circle to pause · inhale with the glow · exhale as it softens
  </div>
</div>

<script>
(() => {
  const root=document.documentElement;
  const mandala=document.getElementById('mandala');
  const toggle=document.getElementById('toggle');
  const paceBtn=document.getElementById('pace');
  const soundBtn=document.getElementById('sound');
  const vol=document.getElementById('vol');
  const hint=document.getElementById('hint');

  const getS=n=>parseFloat(getComputedStyle(root).getPropertyValue(n))*1000;
  function setCycle(){
    const c=getS('--inhale')+getS('--hold')+getS('--exhale');
    root.style.setProperty('--cycle',c+'ms'); return c;
  }
  let cycle=setCycle();

  // audio
  let audioOn=true,ctx,gain;
  soundBtn.onclick=()=>{audioOn=!audioOn; soundBtn.textContent='sound: '+(audioOn?'on':'off');};
  function tone(freq,durMs){
    if(!audioOn)return;
    ctx=ctx||new(window.AudioContext||window.webkitAudioContext)();
    const osc=ctx.createOscillator();
    gain=gain||ctx.createGain();
    gain.gain.value=(vol.value/100)*0.15;
    osc.type='sine'; osc.frequency.value=freq;
    osc.connect(gain).connect(ctx.destination);
    const now=ctx.currentTime;
    osc.start(now); osc.stop(now+durMs/1000);
  }
  vol.addEventListener('input',()=>{if(gain)gain.gain.value=(vol.value/100)*0.15;});

  // pace toggle
  paceBtn.onclick=()=>{
    const cur=getS('--inhale')/1000;
    if(cur<5){
      root.style.setProperty('--inhale','5.5s');
      root.style.setProperty('--hold','1.5s');
      root.style.setProperty('--exhale','6.5s');
    }else{
      root.style.setProperty('--inhale','4.5s');
      root.style.setProperty('--hold','1.0s');
      root.style.setProperty('--exhale','5.5s');
    }
    cycle=setCycle();
    paceBtn.textContent=`pace: ${(+getS('--inhale')/1000)} · ${(+getS('--hold')/1000)} · ${(+getS('--exhale')/1000)}`;
  };

  // breathing loop
  let running=true,tmr;
  function loop(){
    const IN=getS('--inhale'),HO=getS('--hold'),EX=getS('--exhale');
    tone(432,360); navigator.vibrate?.(10);
    setTimeout(()=>{tone(528,220); navigator.vibrate?.(6);},IN);
    setTimeout(()=>{tone(396,360); navigator.vibrate?.(8);},IN+HO);
    tmr=setTimeout(loop,IN+HO+EX);
  }
  loop();

  function start(){
    if(running)return; running=true;
    mandala.classList.add('pulse'); toggle.textContent='pause'; loop();
    hint.textContent='tap the circle to pause · inhale with the glow · exhale as it softens';
  }
  function stop(){
    running=false; clearTimeout(tmr);
    mandala.classList.remove('pulse'); toggle.textContent='start';
    hint.textContent='tap the circle to start breathing again';
  }

  mandala.addEventListener('click',()=>running?stop():start(),{passive:true});
  toggle.addEventListener('click',()=>running?stop():start());
})();
</script>
</body>
</html>
